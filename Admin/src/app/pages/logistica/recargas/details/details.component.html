<div class="details-container">
  
  <!-- Contenedor de alertas flotantes -->
  <div class="alert-container">
    <!-- Alerta de error -->
    <div *ngIf="mostrarAlertaError" class="alert alert-danger alert-border-left alert-dismissible fade show floating-alert" role="alert">
      <i class="ri-error-warning-line me-3 align-middle fs-lg"></i>
      <strong>¡Error!</strong> {{ mensajeError }}
      <button type="button" class="btn-close" (click)="cerrarAlerta()" aria-label="Close"></button>
    </div>
  </div>
  
  <!-- Botón de regresar -->
  <div class="details-header-button">
    <button type="button" class="btn btn-primary" (click)="cerrar()">
      <span class="btn-text">Regresar</span>
      <span class="btn-icon"><i class="ri-arrow-left-line"></i></span>
    </button>
  </div>
  
  <!-- Contenido de detalles -->
  <div *ngIf="!cargando && recargaDetalle" class="details-content">
    <div class="col-md-12">
      
      <!-- Información general de la recarga -->
      <div class="card h-100 shadow-sm employee-details-card bg-dark-blue mb-4">
        <div class="card-header d-flex align-items-center rounded-top details-header-custom">
          <i class="ri-truck-line me-2 fs-4"></i>
          <h5 class="mb-0">Detalles de la Recarga #{{ recargaDetalle.reca_Id }}</h5>
          <div class="ms-auto">
            <span class="badge bg-light text-dark">
              {{ recargaDetalle.totalProductos || getTotalTiposProductos() }} productos
            </span>
          </div>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-sm-6 col-lg-3">
              <div class="detail-item">
             <div class="detail-icon bg-dark-blue text-white">
                  <i class="ri-store-2-line"></i>
                </div>
                <div class="detail-content">
                  <div class="detail-label">Bodega</div>
                  <div class="detail-value">{{ recargaDetalle.bode_Descripcion || 'N/A' }}</div>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
              <div class="detail-item">
                <div class="detail-icon bg-dark-blue text-white">
                  <i class="ri-calendar-line"></i>
                </div>
                <div class="detail-content">
                  <div class="detail-label">Fecha de Recarga</div>
                  <div class="detail-value">{{ formatearFecha(recargaDetalle.reca_Fecha) }}</div>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
              <div class="detail-item">
                <div class="detail-icon bg-dark-blue text-white">
                  <i class="ri-file-text-line"></i>
                </div>
                <div class="detail-content">
                  <div class="detail-label">Observaciones</div>
                  <div class="detail-value">
                    <span [title]="recargaDetalle.reca_Observaciones">
                      {{ (recargaDetalle.reca_Observaciones && recargaDetalle.reca_Observaciones.length > 30) 
                         ? (recargaDetalle.reca_Observaciones | slice:0:30) + '...' 
                         : (recargaDetalle.reca_Observaciones || 'Sin observaciones') }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-6 col-lg-3">
              <div class="detail-item">
                <div class="detail-icon bg-dark-blue text-white">
                  <i class="ri-checkbox-circle-line"></i>
                </div>
                <div class="detail-content">
                  <div class="detail-label">Estado</div>
                  <div class="detail-value">
                    <span class="badge" [class]="getEstadoClase()">
                      {{ getEstadoConfirmacion() }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabla de productos -->
      <div class="card shadow-sm mb-4">
             <div class="card-body p-0">
          <div class="table-responsive" *ngIf="recargaDetalle.productos && recargaDetalle.productos.length > 0">
            <table class="table table-hover mb-0">
              <thead class="table-dark">
                <tr>
                  <th scope="col" class="px-4 py-3" style="width: 10%;">
                    <i class="ri-hashtag me-2"></i>
                  </th>
                  <th scope="col" class="px-4 py-3" style="width: 25%;">
                   Código
                  </th>
                  <th scope="col" class="px-4 py-3" style="width: 50%;">
                    Descripción
                  </th>
                  <th scope="col" class="px-4 py-3 text-center" style="width: 15%;">
                   Cantidad
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let producto of recargaDetalle.productos; let i = index; trackBy: trackByProducto" 
                    [class]="i % 2 === 0 ? 'table-light' : ''">
                  <td class="px-4 py-3 text-muted">
                    {{ i + 1 }}
                  </td>
                  <td class="px-4 py-3">
                    <span class="fw-medium ">{{ producto.prod_Codigo }}</span>
                                      </td>
                  <td class="px-4 py-3">
                    <span class="text-dark">{{ producto.prod_DescripcionCorta }}</span>
                    <div *ngIf="producto.reDe_Observaciones" class="text-muted small mt-1">
                      <i class="ri-information-line me-1"></i>{{ producto.reDe_Observaciones }}
                    </div>
                  </td>
                  <td class="px-4 py-3 text-center">
                    <span class="badge bg-primary fs-6">{{ producto.reDe_Cantidad }}</span>
                  </td>
                </tr>
              </tbody>
              <tfoot class="table-secondary">
                <tr>
                  <td colspan="3" class="px-4 py-3 fw-bold text-end">
                    <i class="ri-calculator-line me-2"></i>Total de productos:
                  </td>
                  <td class="px-4 py-3 text-center">
                    <span>{{ getTotalProductos() }}</span>
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
          
          <!-- Mensaje cuando no hay productos -->
          <div *ngIf="!recargaDetalle.productos || recargaDetalle.productos.length === 0" 
               class="text-center p-5">
            <i class="ri-inbox-line display-1 text-muted mb-3"></i>
            <h4 class="text-muted">No hay productos</h4>
            <p class="text-muted">No se encontraron productos registrados para esta recarga</p>
         </div>
        </div>
      </div>

      
    <!-- Tabla de auditoría -->
    <div class="audit-table-container">
      <div class="audit-table">
        <div class="audit-header">
          <div class="audit-col">Acción</div>
          <div class="audit-col">Usuario</div>
          <div class="audit-col">Fecha</div>
        </div>
      
      <!-- Fila de creación -->
      <div class="audit-row">
        <div class="audit-col">
          <span class="audit-action">Creador</span>
        </div>
        <div class="audit-col">
          <span class="audit-user">{{ recargaDetalle.usuarioCreacion || 'N/A' }}</span>
        </div>
        <div class="audit-col">
          <span class="audit-date">{{ formatearFecha(recargaDetalle.reca_FechaCreacion || null) }}</span>
        </div>
      </div>
      
      <!-- Fila de modificación -->
      <div class="audit-row">
        <div class="audit-col">
          <span class="audit-action">Modificación</span>
        </div>
        <div class="audit-col">
          <span class="audit-user">{{ recargaDetalle.usuarioModificacion || 'N/A' }}</span>
        </div>
        <div class="audit-col">
          <span class="audit-date">{{ formatearFecha(recargaDetalle.reca_FechaModificacion || null )  }}</span>
        </div>
      </div>
    </div>

  <!-- Loading overlay -->
  <div *ngIf="cargando" class="loading-overlay">
    <div class="loading-spinner">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2">Cargando detalles y procesando productos...</p>
    </div>
  </div>
</div>